<?xml version="1.0" encoding= "UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="admin">
	<select id="get5Projects" resultType="com.nbreds.projectPlanning.Project.VO.Project">
    <![CDATA[
   	select P.pname, P.pregdate, P.pduedate, U.uname
	FROM Project P, User U
	WHERE P.uno = U.uno
	ORDER BY P.pregdate DESC
	LIMIT 5
    ]]>  
    </select>
    
    <select id="get5Users" resultType="com.nbreds.projectPlanning.common.VO.User">
    <![CDATA[
   	SELECT uname, uphoneno, udepartment, uemail, uregdate
  	FROM User
	ORDER BY uregdate DESC
	LIMIT 5
    ]]>  
    </select>
    
    <select id="getCountUsers" resultType="int">
    <![CDATA[
	SELECT count(*)
	FROM User
    ]]>  
    </select>
    
    <select id="getCountProjects" resultType="int">
    <![CDATA[
	SELECT count(*)
	FROM Project
    ]]>  
    </select>
    
    <select id="getAllProjects" resultType="com.nbreds.projectPlanning.Project.VO.Project">
    <![CDATA[
	SELECT P.pno, P.pname, P.pregdate, P.pduedate, P.uno, U.uname
	FROM Project P, User U
	WHERE P.uno = U.uno
	ORDER BY P.pregdate DESC
    ]]>  
    </select>
    
    <delete id="removeProjects" parameterType="int">
    <![CDATA[
    delete from Project where pno=#{i}
    ]]>  
    </delete>
	
	<!-- 
    <select id="allProjectList" parameterType="Map" resultType="com.nbreds.projectPlanning.Project.VO.Project">
    <![CDATA[
    SELECT pno, pname, pdetail, pdata, pduedate, uno
    FROM Project
    ]]>
    <if test="pdata != null">
		<where>
			<foreach collection="pdata" item="data" index="index" separator="or">
		<![CDATA[
				pdata like '%' #{data} '%'
		]]>
			</foreach>
		</where>
	</if>
	<![CDATA[
	ORDER BY pno DESC
	LIMIT #{start}, #{interval}
    ]]>
    </select>
    -->
    
    <!-- 페이징 처리를 위한 selectAllUser -->
	<select id="selectAllUser" parameterType="Map" resultType="com.nbreds.projectPlanning.common.VO.User">
	<![CDATA[	
		SELECT uno, uname, uphoneno, udepartment, uemail, upassword, uregdate
		FROM User
		]]>
		<if test="word != null and !word.equals('') and !key.equals('all')">
			<where>
				<choose>
					<when test="key.equals('name')">
						uname like '%' #{word} '%'
					</when>
					<when test="key.equals('phoneNumber')">
						uphoneno like '%' #{word} '%'
					</when>
					<when test="key.equals('email')">
						uemail like '%' #{word} '%'
					</when>
				</choose>
			</where>
		</if>
	<![CDATA[
	ORDER BY uno DESC
	LIMIT #{start}, #{interval}
	]]>
	</select>
	
	<!-- 페이징 처리를 위한 totalCount -->
    <select id="totalUserCount" parameterType="Map" resultType="int">
    <![CDATA[
    SELECT COUNT(*) cnt
    FROM User
    ]]>
    <if test="word != null and !word.equals('') and !key.equals('all')">
			<where>
				<choose>
					<when test="key.equals('name')">
						uname like '%' #{word} '%'
					</when>
					<when test="key.equals('phoneNumber')">
						uphoneno like '%' #{word} '%'
					</when>
					<when test="key.equals('email')">
						uemail like '%' #{word} '%'
					</when>
				</choose>
			</where>
		</if>
    </select>
	
	<select id="getDepartmentList" parameterType="String" resultType="com.nbreds.projectPlanning.common.VO.CodeTable">
	<![CDATA[	
		SELECT CODE_TYPE, CODE, CODE_NAME
		FROM CodeTable
		WHERE CODE_TYPE = #{codeType}
	]]>
	</select>
	
	<select id="getProjectsByPname" parameterType="String" resultType="com.nbreds.projectPlanning.Project.VO.Project">
	<![CDATA[	
	SELECT P.pno, P.pname, P.pregdate, P.pduedate, P.uno, U.uname
	FROM Project P, User U
	WHERE P.uno = U.uno AND P.pname like '%' #{item} '%'
	ORDER BY P.pregdate DESC
	]]>
	</select>
	
	<select id="getProjectsByUname" parameterType="String" resultType="com.nbreds.projectPlanning.Project.VO.Project">
	<![CDATA[	
	SELECT P.pno, P.pname, P.pregdate, P.pduedate, P.uno, U.uname
	FROM Project P, User U
	WHERE P.uno = U.uno AND U.uname like '%' #{item} '%'
	ORDER BY P.pregdate DESC
	]]>
	</select>
</mapper>